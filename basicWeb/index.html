<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>홍쌤의 블루투스 웹컨트롤러</title>
</head>
<body>
  <center>
    <h1>블루투스 웹컨트롤러</h1>
    <button id="bluetoothButton">블루투스</button>

    <script>
      const bluetoothButton = document.getElementById("bluetoothButton");

      bluetoothButton.addEventListener("click", async () => {
        try {
          const device = await navigator.bluetooth.requestDevice({
            filters: [{ services: ["0000ffe0-0000-1000-8000-00805f9b34fb"] }]
          });
          console.log('Connected to device:', device.name);

        } catch (error) {
          console.error('Connection failed:', error);
        }
      });
      
      windowNavigator.bluetooth.requestDevice({
        filters: [{ services: ["4번 결과 값"] }]
      })
      .then(function(device) {
        getDevice(device)
        return device.gatt.connect();
      })
      .then(function(server) {
        return server.getPrimaryService("0000ffe0-0000-1000-8000-00805f9b34fb");
      })
      .then(function(service) {
        return service.getCharacteristic("0000ffe1-0000-1000-8000-00805f9b34fb");
      })
      .then(function(characteristic) {
        getCharacteristic(characteristic);
      })
      .catch(function(error) {
        console.error('Connection failed!', error);
      });
      
      function getDevice(device) {
        device.addEventListener('gattserverdisconnected', () => {
          alert("디바이스 연결이 끊어졌습니다.");
        });
      }
      
      function getCharacteristic(characteristic) {
        characteristic.writeValue(new Uint8Array([0x04, 0x03, 0x02, 0x01]))
      }
      
      function getCharacteristic(characteristic) {
        characteristic.startNotifications().then(() => {
          characteristic.addEventListener('characteristicvaluechanged', function(e) {
            const value = e.target.value.getUint8(0).toString(10);
            console.log(value);
          });
        })
      }

      
    </script>

    

    <button type="button" onclick="servo_up()">각도 +</button>
    <button type="button" onclick="servo_down()">각도 -</button>
  </center>
</body>
</html>
